<?xml version="1.0" standalone="no"?>

<stack>

	<description>

	Adds the pallets to the frontend

	</description>

        <si_copyright>
        Copyright (c) 2006 - 2017 StackIQ Inc.
        All rights reserved. stacki(r) v4.0 stacki.com
        https://github.com/Teradata/stacki/blob/master/LICENSE.txt
        </si_copyright>

        <copyright>
        Copyright (c) 2000 - 2010 The Regents of the University of California
        All rights reserved. Rocks(r) v5.4 www.rocksclusters.org
        https://github.com/Teradata/stacki/blob/master/LICENSE-ROCKS.txt
        </copyright>

<post shell='python'>
import os
import os.path
import sys
import stack.api
import stack.roll

if not os.path.exists('/tmp/rolls.xml'):
	sys.exit()

generator = stack.roll.Generator()
generator.parse('/tmp/rolls.xml')

found = []
for name, version, release, arch, url, diskid in generator.rolls:
		purl = '%s/%s/%s/%s/%s/%s/' % (url, name, version, release, 'redhat', arch)

		print '\n'.join(stack.api.Call('add.pallet',[purl]))
		print '\n'.join(stack.api.Call('enable.pallet', [name]))

</post>

</stack> 
